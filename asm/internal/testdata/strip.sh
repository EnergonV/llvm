#!/bin/bash
if [ $# -lt 1 ]; then
	echo "Usage: strip FILE.ll"
	exit 1
fi
f=$1
sar -i "^; <label>:([0-9]+)[^\n]+" "\$1:" "${f}"
sar -i "[\n]; <label>:([0-9]+)[^\n]+" "\$1:" "${f}"
sar -i "^;[^\n]+" "" "${f}"
sar -i "[\n];[^\n]+" "" "${f}"
sar -i "^define[^\n]*" "\$0\n0:" "${f}"
sar -i "[\n]define[^\n]*" "\$0\n0:" "${f}"
sar -i "([0-9]+):\n" "; <label>:\$1\n" "${f}"
sar -i "^source_filename[^\n]+" "" "${f}"
sar -i "[\n]source_filename[^\n]+" "" "${f}"
sar -i "^target[^\n]+" "" "${f}"
sar -i "[\n]target[^\n]+" "" "${f}"
sar -i "^attributes[^\n]+" "" "${f}"
sar -i "[\n]attributes[^\n]+" "" "${f}"
sar -i "[)] #[0-9]+" ")" "${f}"
sar -i "^[!][^\n]+" "" "${f}"
sar -i "[\n][!][^\n]+" "" "${f}"
sar -i ", align [0-9]+\n" "\n" "${f}"
sar -i "\n\n" "\n" "${f}"
sar -i "\n\n" "\n" "${f}"
sar -i "^\n" "" "${f}"
sar -i "[\n]  " "\n\t" "${f}"
sar -i "[\n][\t]  " "\n\t\t" "${f}"
sar -i "(add|mul|sub) nsw " "\$1 " "${f}"
sar -i "getelementptr inbounds " "getelementptr " "${f}"
#sar -i " common " " " "${f}"
sar -i "private unnamed_addr constant " "constant " "${f}"
sar -i "(i8|i16|i32|call) signext " "\$1 " "${f}"
sar -i "(i8|i16|i32|call|define) zeroext" "\$1 " "${f}"
sar -i "[*] nocapture" "*" "${f}"
sar -i "[*] writeonly" "*" "${f}"
sar -i "[*] nocapture" "*" "${f}"
sar -i " volatile " " " "${f}"
sar -i "[\n]define internal " "\ndefine " "${f}"
sar -i "internal (constant|global) " "\$1 " "${f}"
#sar -i "getelementptr ([^,]+), ([^,]+), i32 0, i32 0" "getelementptr \$1, \$2, i64 0, i64 0" "${f}"
sar -i "[.]000000e[+]00" ".0" "${f}"
